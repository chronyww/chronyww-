1.	Протокол IPsec. Функции. Принцип работы. Компоненты
IPsec** — это набор протоколов для обеспечения безопасной передачи данных на уровне IP. Обеспечивает шифрование, аутентификацию и защиту целостности трафика в сетях.
Основные функции:
- **Конфиденциальность** — шифрование данных (через ESP).
- **Аутентификация** — подтверждение подлинности отправителя.
- **Целостность данных** — защита от изменения пакетов при передаче.
- **Защита от повторных атак** — предотвращает повторное воспроизведение пакетов.
Принцип работы:
1. Установление защищённого соединения через протокол **IKE**.
2. Обмен криптографическими ключами и согласование параметров безопасности.
3. Шифрование и/или аутентификация данных с помощью **ESP** или **AH**.
4. Передача защищённого трафика по сети.
5. Расшифровка и проверка целостности на принимающей стороне.
Работает в двух режимах:
- **Транспортный режим** — шифруются только данные, IP-заголовок остаётся открытым (для связи между устройствами).
- **Туннельный режим** — шифруется весь IP-пакет, используется для создания VPN (например, Site-to-Site).
Компоненты IPsec:
AH (Authentication Header)
   - Отвечает за **аутентификацию** и **целостность** данных.
   - Не шифрует содержимое пакетов.
   - Защищает IP-заголовки от подделки.
ESP (Encapsulating Security Payload)
   - Обеспечивает **шифрование**, **аутентификацию** и **целостность**.
   - Может работать как в транспортном, так и в туннельном режиме.
IKE (Internet Key Exchange)**
   - Протокол обмена ключами.
   - Используется для безопасного установления соединения и обмена ключами.
   - Работает в 2 фазы:
     - **Фаза 1** — установка безопасного канала (асимметричное шифрование).
     - **Фаза 2** — обмен данными через симметричное шифрование.
Где применяется:
В VPN (Site-to-Site и Remote Access).
Для защиты коммуникаций между серверами.
- В корпоративных сетях для безопасной передачи данных через интернет.
Преимущества:
- Высокая степень безопасности.
- Поддержка различных алгоритмов шифрования.
- Прозрачность для приложений.
Недостатки:
- Сложность настройки.
- Дополнительная нагрузка на сеть.
- Проблемы с NAT (требует NAT-T).
2.	Сети VPN. Шифрование VPN. Типы шифрования
Что такое VPN?  
VPN (Virtual Private Network)  — это технология создания защищённого соединения через публичные сети, например, Интернет. Она использует туннелирование  и шифрование , чтобы обеспечить конфиденциальность, целостность и аутентификацию данных. 
Зачем нужно шифрование в VPN?  
    Защита от прослушивания данных 
    Предотвращение атак типа Man-in-the-Middle .
    Обеспечение конфиденциальности передаваемой информации.
    Гарантия целостности данных (предотвращение их изменения при передаче).
Как работает шифрование в VPN  
    Инкапсуляция  – данные упаковываются в новый пакет для передачи через туннель.
    Шифрование  – данные и заголовки шифруются с помощью криптографического алгоритма.
    Передача  – зашифрованный трафик отправляется через общедоступную сеть.
    Декапсуляция и расшифровка  – на принимающей стороне данные расшифровываются и восстанавливаются в исходный вид.
Типы шифрования в VPN  
1. Симметричное шифрование  
    Используется один ключ для шифрования и расшифровки.
    Быстрый и эффективный метод.
    Примеры: AES , 3DES .
2. Асимметричное шифрование  
    Используются два связанных ключа: открытый  (для шифрования) и закрытый  (для расшифровки).
    Применяется чаще всего для безопасного обмена ключами.
    Пример: RSA .
Основные алгоритмы шифрования в VPN  
AES(Advanced Encryption Standard)СимметричныйСовременный и самый распространённый стандарт. Использует ключи 128, 192 или 256 бит. Высокий уровень безопасности.
3DES(Triple Data Encryption Standard)СимметричныйУлучшенная версия DES. Менее безопасен, чем AES. Иногда используется в старых системах.
RSAАсимметричныйИспользуется для обмена ключами. Не шифрует весь трафик напрямую, но обеспечивает его безопасную передачу.
BlowfishTwofishСимметричныйРанее использовались в некоторых VPN-решениях. Менее популярны сегодня.
Протоколы шифрования в VPN  
    IPsec  – набор протоколов, обеспечивающий шифрование на уровне IP. Часто используется с IKE для обмена ключами.
    OpenVPN  – гибкий и безопасный протокол, поддерживающий AES.
    WireGuard  – современный протокол с минимальным кодом и высокой производительностью. Использует шифрование ChaCha20 и Curve25519.
    IKEv2/IPsec  – особенно популярен для мобильных устройств благодаря устойчивости к разрывам соединения
3.	Создать и настроить виртуальный коммутатор с «VLAN-ами» на виртуальной машине, используя Open vSwitch (OVS).


Создать два компика но вообще вланы можно настроить на одном компе
1 комп 172.16.4.1/28
2 комп 172.16.4.2/28
(apt update –y)
На ISP пишем:
nano /etc/sysctl.conf
Находим строчку
#net.ipv4.ip_forward=1
Раскомментируем её
net.ipv4.ip_forward=1
(iptables –t nat –A POSTROUTING –j MASQUERADE)
(apt install iptables-persistent -y)
(перезагрузить пк что бы интернет встал на второй комп при подключении к нему + iptables –t nat –S для проверки стоит ли построутинг и маскарад)
Все действия на первом компе делаются:
apt-get install openvswitch-switch
systemctl enable --now openvswitch-switch
ovs-vsctl add-br hq-sw
ovs-vsctl add-port hq-sw ens4 tag=100
(добавлять цифру в ens и tag= в зависимости от того сколько компов создаем но у нас два)
ovs-vsctl add-port hq-sw vlan100 tag=100 -- set interface vlan100 type=internal
systemctl restart openvswitch-switch
systemctl restart NetworkManager
ip link set hq-sw up
ip a add 172.16.4.1/28 dev vlan100
ip link set vlan100 up
ip –c –br a (там покажет включенные вланы)
пингуем влан 100 и все

